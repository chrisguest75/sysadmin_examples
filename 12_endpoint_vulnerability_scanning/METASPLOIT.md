# README

Demonstrate how to use `metasploit` to scan for vulnerabilities

TODO:

* metasploitable
* openssh container
* create a reverse shell payload.  

## Metasploit

Basic idea follows

`msfconsole` is the terminal app. 
`show exploits` will show the exploits in the db.
`info <exploit>` will provide the manpage for the exploit
`use <exploit>` will select the exploit 
`set RHOST <target host>` will select the host
`show payloads` will show the payloads that can get you a shell 
`set PAYLOAD`
`exploit`

## Install the framework

To get the installer for the framework goto the nightly installers [here](https://github.com/rapid7/metasploit-framework/wiki/Nightly-Installers)

```sh
# configure a new database
msfconsole

# update a previously installed msf
msfupdate

# view a list of tips
tips

# show a list of exploits
show exploits
```

## Host an exploitable container

```sh
# you have to build with profiles as well
docker compose --profile nginx build --no-cache  
docker compose --profile nginx build 

# host containers
docker-compose --profile nginx up -d 
```

## msfconsole

```sh
# shell on metasploit container
docker exec -it  $(docker ps --filter name=12_endpoint_vulnerability_scanning-metasploit-1 -q) /bin/bash 

# initialise the db
msfdb init 

# metasploit console
msfconsole 

# inside msfconsole 
db_nmap -v -sV 172.16.238.0/24

db_nmap -sV -A 0.0.0.0 --script vulners

# after scanning use hosts
hosts
# add to RHOSTS
hosts -R

# search exploits
search SSH type:exploit
search platform:linux ssh
```

## ssh login
```sh
hosts

# look at ssh_login
info auxiliary/scanner/ssh/ssh_login

# use ssh login with known password
use auxiliary/scanner/ssh/ssh_login
set VERBOSE true
set PASSWORD 'test'
set USERNAME test
run
set RHOSTS 172.16.238.2
```

## Troubleshooting

Building container from shell

```sh
# build metasploit
docker build -t metasploit -f ./metasploit.Dockerfile . 
docker run -it --rm  --name metasploit --entrypoint /bin/bash metasploit

# build ssh
docker build -t ssh -f ./ssh.Dockerfile . 
docker run -it --rm --name ssh -p 22:22 --entrypoint /bin/bash ssh
docker run --rm --name ssh -p 8022:22 ssh
ssh -p 8022 test@0.0.0.0   
```

### Cleanup

```sh
docker compose --profile nginx down    
```

## Resources

* Metasploit homepage [here](https://www.metasploit.com/)
* Metasploit tutorial [here](https://jonathansblog.co.uk/metasploit-tutorial-for-beginners)
* Metasploit tutorial [here](https://jonathansblog.co.uk/how-to-use-metasploit-to-scan-for-vulnerabilities)
* metasploit-framework Github repo [here](https://github.com/rapid7/metasploit-framework)
* The-Art-of-Hacking/h4cker [here](https://github.com/The-Art-of-Hacking/h4cker)

## Vulnerabilities

* Rapid7 Exploit DB [here](https://www.rapid7.com/db/?)
* nginx stackwatch [here](https://stack.watch/product/nginx/nginx/)
* openssh stackwatch [here](https://stack.watch/product/openbsd/openssh/)

## Exploits and Pentesting

* [SSH brute force](https://charlesreid1.com/wiki/Metasploitable/SSH/Brute_Force)
* [SSH Exploit](https://charlesreid1.com/wiki/Metasploitable/SSH/Exploits)
* Docker for Pentesters [here](https://blog.ropnop.com/docker-for-pentesters/)
* Building a Pentest lab with Docker [here](https://medium.com/@muchina/what-is-docker-2a21077b98df)
* Metasploitable 3 (Linux) Walkthrough: An Exploitation Guide [here](https://stuffwithaurum.com/2020/04/17/metasploitable-3-linux-an-exploitation-guide/)
* Metasploitable3: An Intentionally Vulnerable Machine for Exploit Testing [here](https://www.rapid7.com/blog/post/2016/11/15/test-your-might-with-the-shiny-new-metasploitable3/)
* Use Metasploit's Database to Stay Organized & Store Information While Hacking [here](https://null-byte.wonderhowto.com/how-to/use-metasploits-database-stay-organized-store-information-while-hacking-0192643/)
* DNS Enumeration with Metasploit [here](http://www.darkoperator.com/blog/2009/12/11/enumeration-thru-dns-and-metasploit.html)
https://websploit.org/
