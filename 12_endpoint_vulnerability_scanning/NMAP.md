# README

Demonstrate how to use `nmap` to scan for vulnerabilities

TODO:

* Detect CVE on nginx - is it possible to exploit it?

## Sharing network namespace

```sh
# show the profiles in the docker-compose.yaml
docker compose config --profiles

# you have to build with profiles as well
docker compose --profile nginx build --no-cache  

docker compose --profile nginx up -d  
#docker compose up -d                
```

## Using nmap to scan

```sh
# exec into the debug container
docker exec -it  $(docker ps --filter name=12_endpoint_vulnerability_scanning-debug_nginx-1 -q) /bin/bash 
```

Show all processes in the namespace from the debug container

```sh
# should see node process in other container
ps -aux

# pid of current bash
echo $BASHPID 

# check network namespace access
curl 0.0.0.0:80
```

## Use nmap to scan

```sh
nmap --version

# show built in nmap scripts
ls -1 /usr/share/nmap/scripts

# scan the services inside the current network namespace
nmap -sV 0.0.0.0

# scan the host (docker for mac)
ping host.docker.internal
nmap -sV host.docker.internal

# scan nginx port
nmap -p 80 -sV -A 0.0.0.0
```

## Nmap vulners script

Matches vulnerabilities to versions of software detected on a port.

```sh
# vulners script help
nmap --script-help vulners

# give a list back of the CVE 
nmap -p 80 -sV -A 0.0.0.0 --script vulners 

# all containers on compose network
nmap -p 22 -sV -A 172.16.238.0/24 --script vulners 
```

## vulscan

Matches vulnerabilities to versions of software detected on a port.

```sh
git clone https://github.com/scipag/vulscan scipag_vulscan
ln -s `pwd`/scipag_vulscan /usr/share/nmap/scripts/vulscan    
nmap -sV --script=vulscan/vulscan.nse 0.0.0.0 

# use the ip address of the ssh container
nmap -sV --script=vulscan/vulscan.nse 172.16.238.2
```

### Cleanup nginx

```sh
docker compose --profile nginx down    
```

## Resources

### Documentation

* NMap site [here](https://nmap.org/)  
* NMap Book [here](https://nmap.org/book/toc.html)  
* Tutorial [here](https://hackertarget.com/nmap-tutorial/)

### Vulnerability Scanning

* nmap-vulners [here](https://github.com/vulnersCom/nmap-vulners)
* vulners [here](https://nmap.org/nsedoc/scripts/vulners.html)
* vulscan [here](https://github.com/scipag/vulscan)  
* 12 useful scripts [here](https://research.securitum.com/nmap-and-12-useful-nse-scripts/)  

### Compose IPAM (ip address management)

* [compose-file-v2](https://docs.docker.com/compose/compose-file/compose-file-v2/)
