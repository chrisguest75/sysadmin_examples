services:
    nginx:
        image: nginx:1.15.3
        ports:
            - 8080:80
        networks:
            - service_bridge    
        profiles: [nginx]  

    debug_nginx:
        build: 
            context: .
            dockerfile: debug.Dockerfile
        command: [ "/bin/sh", "-c", "sleep infinity" ]  
        pid: "container:12_endpoint_vulnerability_scanning-nginx-1" 
        network_mode: service:nginx
        depends_on:
            - nginx    
        profiles: [nginx]   

    ssh:
        build: 
            context: .
            dockerfile: ssh.Dockerfile
        ports:
            - 8022:22
        networks:
            - service_bridge    
        profiles: [nginx]  

    metasploit:
        build: 
            context: .
            dockerfile: metasploit.Dockerfile
        command: [ "/bin/sh", "-c", "sleep infinity" ]  
        networks:
            - service_bridge    
        depends_on:
            - ssh    
        profiles: [nginx]   
        
networks:
    service_bridge:
        driver: bridge  
        ipam:
            driver: default
            config:
                - subnet: 172.16.238.0/24
                  gateway: 172.16.238.1